var s=class s{static get document(){return s._document}static initialize(){if(!s._initialized){try{typeof window<"u"&&window.document&&(s._document=window.document,s._window=window,s._HTMLElement=window.HTMLElement)}catch{}s._initialized=!0}}static configure(e){e.document&&(s._document=e.document),e.window&&(s._window=e.window),e.HTMLElement&&(s._HTMLElement=e.HTMLElement),typeof e.ssr<"u"&&(this.ssr=e.ssr),s._initialized=!0}static ensureInitialized(){s._initialized||s.initialize(),s.ensureAvailable(s._document,"document"),s.ensureAvailable(s._window,"window"),s.ensureAvailable(s._HTMLElement,"HTMLElement")}static ensureAvailable(e,r){if(!e)throw new Error(`CfDom: ${r} is not available.Please configure CfDom with a valid DOM implementation.`)}static createElement(e){return s.ensureInitialized(),s._document.createElement(e)}static createDocumentFragment(){return s.ensureInitialized(),s._document.createDocumentFragment()}static querySelector(e,r){return s.ensureInitialized(),(r??s._document).querySelector(e)}static querySelectorAll(e,r){return s.ensureInitialized(),(r??s._document).querySelectorAll(e)}static get body(){return s.ensureInitialized(),s._document.body}static addElEventListener(e,r,n,i){if(s.ensureInitialized(),this.isSsr())throw new Error("Event listeners are not available in SSR contexts!");e.addEventListener(r,n,i)}static isHTMLElement(e){return s.ensureInitialized(),e instanceof s._HTMLElement}static isBrowser(){return typeof window<"u"&&!!window.document}static isUsingCustomDOMImplementation(){return s.ensureInitialized(),s._document!==null&&(typeof window>"u"||s._document!==window.document)}static isSsr(e){return typeof e<"u"?this.ssr=e:this.ssr}};s._document=null,s._window=null,s._HTMLElement=null,s._initialized=!1,s.ssr=!1;var a=s;a.initialize();var L=(t,e)=>{if(!("into"in e)&&!("after"in e)&&!("before"in e))throw new Error("No valid position specified. Use 'into', 'after', or 'before'.");let r="beforeend",n;"after"in e?(r="afterend",n=e.after):"before"in e?(r="beforebegin",n=e.before):("into"in e&&e.at==="start"&&(r="afterbegin"),n=e.into);let i=a.createDocumentFragment();if(Array.isArray(t))for(let o of t)i.appendChild(o);else i.appendChild(t);if(r==="beforebegin"){let o=n.parentNode;o&&o.insertBefore(i,n)}else if(r==="afterend"){let o=n.parentNode;o&&o.insertBefore(i,n.nextSibling)}else r==="afterbegin"?n.insertBefore(i,n.firstChild):n.appendChild(i);return t},H=t=>globalThis.addEventListener("DOMContentLoaded",t);function v({s:t,all:e,from:r,single:n}){let i=r??a.document;if(e)return Array.from(a.querySelectorAll(t,i));let o=a.querySelector(t,i);return n?o:[o]}var A=t=>t.remove(),D=t=>{t.innerHTML=""};var p=t=>t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):"",I=t=>{if(!t)return"";let e=/&(?:amp|lt|gt|quot|#(0+)?39);/g,r={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};return t.replace(e,n=>r[n]||"'")},C=(...t)=>{let e=0,r=t[0],n=1;typeof t[1]<"u"&&(e=t[0],r=t[1]),t[2]&&(n=t[2]);let i=[];for(let o=e;o<r;o+=n)i.push(o);return i},R=t=>{let e=["<"];return e.push(t.tagName.toLowerCase()),t.id&&e.push(`#${t.id}`),t.className.trim()&&e.push(`.${t.className.split(" ").join(".")}`),e.push(...Array.from(t.attributes).map(r=>`${r.name}="${r.value}"`).slice(0,3).join(" ")),e.join("")},O=()=>{if(!a.isBrowser())return;let t=new MutationObserver(e=>{for(let r of e)r.addedNodes.forEach(n=>{if(!a.isHTMLElement(n))return;let i=r.target;if(console.log(i,n),!i.hasAttribute("data-cf-deps")||i.hasAttribute("data-cf-fg-updates"))return;let o=n.querySelectorAll?.("[data-cf-deps]").length??0;!n.hasAttribute("data-cf-deps")&&o===0||console.warn(`[Campfire] \u26A0\uFE0F A reactive node ${R(n)} was inserted into a reactive container ${R(i)} This may cause it to be wiped on re-render.`)})});a.body.hasAttribute("cf-disable-mo")||t.observe(a.body,{childList:!0,subtree:!0})};var Z=t=>a.createElement(t),V=t=>{let e=t?t.match(/([0-9a-zA-Z\-]*)?(#[0-9a-zA-Z\-]*)?((.[0-9a-zA-Z\-]+)*)/):void 0,r=e?e.slice(1,4)?.map(n=>n?n.trim():void 0):Array(3).fill(void 0);return r&&r[1]&&(r[1]=r[1].replace(/#*/g,"")),e?{tag:r[0]||void 0,id:r[1]||void 0,classes:r[2]?r[2].split(".").filter(n=>n.trim()):void 0}:{}},T=class{constructor(e,r){this.props={};r&&(this.props=r),this.info=e}done(){let{tag:e,id:r,classes:n=[]}=V(this.info);if(n?.some(o=>o.includes("#")))throw new Error("Error: Found # in a class name. Did you mean to do elt#id.classes instead of elt.classes#id?");e||(e="div");let i=Z(e);return r&&(i.id=r),n?.length&&n.forEach(o=>i.classList.add(o)),y(i,this.props)}ref(){return this.done()[0]}content(e){return this.props.contents=e,this}attr(e,r){var n;return(n=this.props).attrs||(n.attrs={}),this.props.attrs[e]=r.toString(),this}attrs(e){return this.props.attrs=e,this}raw(e){return this.props.raw=e,this}misc(e,r){var n;return(n=this.props).misc||(n.misc={}),typeof e=="object"?this.props.misc=e:this.props.misc[e]=r,this}style(e,r){var n;return(n=this.props).style||(n.style={}),this.props.style[e]=r,this}styles(e){return this.props.style=e??{},this}on(e,r){var n;return(n=this.props).on||(n.on={}),this.props.on[e]=r,this}gimme(...e){var r;return(r=this.props).gimme||(r.gimme=[]),this.props.gimme=e,this}deps(e){return this.props.deps={...this.props.deps,...e},this}html(e){return this.content(e).raw(!0)}children(e){return this.props.children=e,this}};a.isBrowser()&&("MutationObserver"in globalThis?O():console.warn("MutationObserver was not found in your browser. Campfire will","not be able to warn you of destructive mutations!"));var N=t=>{let e={};for(let r in t){let n=t[r].value;n instanceof Map?e[r]=Object.fromEntries(n.entries()):e[r]=n.valueOf()}return e},G=t=>!(!t||typeof t!="function"),y=(t,e={})=>{let{contents:r,misc:n,style:i,on:o={},attrs:$={},raw:K,gimme:k=[],deps:h={},children:S={}}=e,f="";if(G(r)){Object.entries(h).forEach(([u,E])=>{E.any(g=>{let x=r(N(h),{event:{...g,triggeredBy:u},elt:t});if(x!==void 0){let W=v({s:"[data-cf-slot]",all:!0,from:t}).map(b=>[b.getAttribute("data-cf-slot"),b]);t.innerHTML=x,W.forEach(([b,U])=>{t.querySelector(`cf-slot[name='${b}']`)?.replaceWith(U)})}})});let l=r(N(h),{elt:t});typeof l>"u"?t.setAttribute("data-cf-fg-updates","true"):t.removeAttribute("data-cf-fg-updates"),f=l||""}else typeof r=="string"&&(f=r);f?.trim()&&(t.innerHTML=K?f:p(f),t.querySelectorAll("cf-slot[name]").forEach(l=>{let u=l.getAttribute("name");if(u&&u in S){let E=S[u],[g]=Array.isArray(E)?E:[E];if(!g)return;l.replaceWith(g),g.setAttribute("data-cf-slot",u)}})),Object.values(h).map(l=>l.id).length?t.setAttribute("data-cf-reactive","true"):t.removeAttribute("data-cf-reactive"),n&&Object.assign(t,n),i&&Object.assign(t.style,i),Object.entries(o).forEach(([l,u])=>a.addElEventListener(t,l,u)),Object.entries($).forEach(([l,u])=>t.setAttribute(l,String(u)));let M=[];for(let l of k){let u=t.querySelector(l);M.push(u)}return[t,...M]},P=(t="div",e={})=>new T(t,e);var j=new Set,z=()=>"cf-"+Math.random().toString(36).slice(2,8),J=()=>{let t=z();for(;j.has(t);)t=z();return j.add(t),t},c=class{constructor(e){this.id=J();this._subscribers={};this._subscriberCounts={};this._dead=!1;this.value=e}on(e,r){var i,o;(i=this._subscriberCounts)[e]??(i[e]=0),(o=this._subscribers)[e]??(o[e]={});let n=this._subscriberCounts[e]++;return this._subscribers[e][n]=r,this._subscriberCounts[e]++}any(e){this.on("append",e),this.on("change",e),this.on("clear",e),this.on("deletion",e),this.on("update",e)}unsubscribe(e,r){delete this._subscribers[e]?.[r]}update(e){this._dead||(this.value=e,this._sendEvent({type:"update",value:e}))}_sendEvent(e){if(this._dead)return;let r=this._subscribers[e.type];if(r)for(let n in r)r[n](e)}dispose(){this._dead=!0,this._subscribers={},this._subscriberCounts={}}valueOf(){return structuredClone(this.value)}};var m=class extends c{constructor(e){super(e||[])}clear(){this.value=[],this._sendEvent({type:"clear"})}push(e){return this.value.push(e),this._sendEvent({type:"append",value:e,idx:this.value.length-1}),this.value.length}remove(e){if(e<0||e>=this.value.length)throw new RangeError("Invalid index.");this._sendEvent({type:"deletion",idx:e,value:this.value.splice(e,1)[0]})}get(e){if(e<0||e>=this.value.length)throw new RangeError("Invalid index.");return this.value[e]}set(e,r){if(e<0||e>=this.value.length)throw new RangeError("Invalid index.");this.value[e]=r,this._sendEvent({type:"change",value:r,idx:e})}get length(){return this.value.length}};var d=class extends c{constructor(e){super(new Map);for(let[r,n]of Object.entries(e||{}))this.value.set(r,n)}set(e,r){this.value.set(e,r),this._sendEvent({key:e,value:r,type:"change"})}remove(e){let r=this.value.get(e);r&&(this.value.delete(e),this._sendEvent({key:e,value:r,type:"deletion"}))}clear(){this.value=new Map,this._sendEvent({type:"clear"})}transform(e,r){let n=this.value.get(e);if(!n)throw new Error(`ERROR: key ${e} does not exist in store!`);let i=r(n);this.set(e,i),this._sendEvent({type:"change",value:i,key:e})}get(e){return this.value.get(e)}has(e){return this.value.has(e)}entries(){return this.value.entries()}};function q(t){if("type"in t){if(t.type==="list")return new m(t.value);if(t.type==="map")return new d(t.value)}return new c(t.value)}var B=(t,e)=>({raw:!0,contents:Array.isArray(t)?t.join(e?.joiner??" "):t.toString()}),_=(t,...e)=>{let r=[];for(let n=0;n<t.length;n++){r.push(t[n]||"");let i=e[n];typeof i<"u"&&typeof i!="object"?r.push(p((i||"").toString())):r.push(i?.contents||"")}return r.join("")};var Q=(t,e={})=>{let r=new RegExp("\\\\({{\\s*"+Object.keys(e).join("|")+"\\s*}})","gi");return new RegExp(Object.keys(e).join("|"),"gi"),t.replace(new RegExp("(^|[^\\\\]){{\\s*("+Object.keys(e).join("|")+")\\s*}}","gi"),function(n,i,o){return`${i||""}${e[o]}`}).replace(r,"$1")},w=(t,e={},r=!0)=>{let n={...e};return r&&(n=Object.fromEntries(Object.entries(n).map(([i,o])=>[i,p(o)]))),Q(t,n)},F=(t,e=!0)=>r=>w(t,r,e);var Ce={ListStore:m,MapStore:d,Store:c,store:q,nu:P,mustache:w,template:F,escape:p,unescape:I,extend:y,insert:L,empty:D,rm:A,select:v,onload:H,html:_,r:B,seq:C,CfDom:a};export{a as CfDom,m as ListStore,d as MapStore,c as Store,Ce as default,D as empty,p as escape,y as extend,_ as html,L as insert,w as mustache,P as nu,H as onload,B as r,A as rm,v as select,C as seq,q as store,F as template,I as unescape};
//# sourceMappingURL=campfire.esm.min.js.map
