var i=class i{static get document(){return i._document}static initialize(){if(!i._initialized){try{typeof window<"u"&&window.document&&(i._document=window.document,i._window=window,i._HTMLElement=window.HTMLElement)}catch{}i._initialized=!0}}static configure(e){e.document&&(i._document=e.document),e.window&&(i._window=e.window),e.HTMLElement&&(i._HTMLElement=e.HTMLElement),typeof e.ssr<"u"&&(this.ssr=e.ssr),i._initialized=!0}static ensureInitialized(){i._initialized||i.initialize(),i.ensureAvailable(i._document,"document"),i.ensureAvailable(i._window,"window"),i.ensureAvailable(i._HTMLElement,"HTMLElement")}static ensureAvailable(e,n){if(!e)throw new Error(`CfDom: ${n} is not available.Please configure CfDom with a valid DOM implementation.`)}static createElement(e){return i.ensureInitialized(),i._document.createElement(e)}static createDocumentFragment(){return i.ensureInitialized(),i._document.createDocumentFragment()}static querySelector(e,n){return i.ensureInitialized(),(n??i._document).querySelector(e)}static querySelectorAll(e,n){return i.ensureInitialized(),(n??i._document).querySelectorAll(e)}static get body(){return i.ensureInitialized(),i._document.body}static addElEventListener(e,n,r,s){if(i.ensureInitialized(),this.isSsr())throw new Error("Event listeners are not available in SSR contexts!");e.addEventListener(n,r,s)}static isHTMLElement(e){return i.ensureInitialized(),e instanceof i._HTMLElement}static isBrowser(){return typeof window<"u"&&!!window.document}static isUsingCustomDOMImplementation(){return i.ensureInitialized(),i._document!==null&&(typeof window>"u"||i._document!==window.document)}static isSsr(e){return typeof e<"u"?this.ssr=e:this.ssr}};i._document=null,i._window=null,i._HTMLElement=null,i._initialized=!1,i.ssr=!1;var l=i;l.initialize();var N=(t,e)=>{if(!("into"in e)&&!("after"in e)&&!("before"in e))throw new Error("No valid position specified. Use 'into', 'after', or 'before'.");let n="beforeend",r;"after"in e?(n="afterend",r=e.after):"before"in e?(n="beforebegin",r=e.before):("into"in e&&e.at==="start"&&(n="afterbegin"),r=e.into);let s=l.createDocumentFragment();if(Array.isArray(t))for(let o of t)s.appendChild(o);else s.appendChild(t);if(n==="beforebegin"){let o=r.parentNode;o&&o.insertBefore(s,r)}else if(n==="afterend"){let o=r.parentNode;o&&o.insertBefore(s,r.nextSibling)}else n==="afterbegin"?r.insertBefore(s,r.firstChild):r.appendChild(s);return t},P=t=>globalThis.addEventListener("DOMContentLoaded",t);function L({s:t,all:e,from:n,single:r}){let s=n??l.document;if(e)return Array.from(l.querySelectorAll(t,s));let o=l.querySelector(t,s);return r?o:[o]}var O=t=>t.remove(),k=t=>{t.innerHTML=""};var p=t=>t?t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;"):"",z=t=>{if(!t)return"";let e=/&(?:amp|lt|gt|quot|#(0+)?39);/g,n={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"};return t.replace(e,r=>n[r]||"'")},B=(...t)=>{let e=0,n=t[0],r=1;typeof t[1]<"u"&&(e=t[0],n=t[1]),t[2]&&(r=t[2]);let s=[];for(let o=e;o<n;o+=r)s.push(o);return s},j=t=>{let e=["<"];return e.push(t.tagName.toLowerCase()),t.id&&e.push(`#${t.id}`),t.className.trim()&&e.push(`.${t.className.split(" ").join(".")}`),e.push(...Array.from(t.attributes).map(n=>`${n.name}="${n.value}"`).slice(0,3).join(" ")),e.join("")},q=()=>{if(!l.isBrowser())return;let t=new MutationObserver(e=>{for(let n of e)n.addedNodes.forEach(r=>{if(!l.isHTMLElement(r))return;let s=n.target;if(!s.hasAttribute("data-cf-deps")||s.hasAttribute("data-cf-fg-updates"))return;let o=r.querySelectorAll?.("[data-cf-deps]").length??0;!r.hasAttribute("data-cf-deps")&&o===0||console.warn(`[Campfire] \u26A0\uFE0F A reactive node ${j(r)} was inserted into a reactive container ${j(s)} This may cause it to be wiped on re-render.`)})});l.body.hasAttribute("cf-disable-mo")||t.observe(l.body,{childList:!0,subtree:!0})},F=t=>(e,...n)=>{t(...n).then(r=>e(null,r)).catch(r=>e(r,null))},U=(t,e,n=!1)=>{let r=null,s=()=>{try{t()}finally{r=setTimeout(s,e)}};return n?s():r=setTimeout(s,e),()=>{r!==null&&clearTimeout(r)}};var K=(t,e)=>({raw:!0,contents:Array.isArray(t)?t.join(e?.joiner??" "):t.toString()}),H=(t,...e)=>{let n=[];for(let r=0;r<t.length;r++){n.push(t[r]||"");let s=e[r];typeof s<"u"&&typeof s!="object"?n.push(p((s??"").toString())):n.push(s?.contents||"")}return n.join("")};var ne=t=>l.createElement(t),se=t=>{let{tag:e,id:n,classes:r=[]}=ie(t);if(r?.some(o=>o.includes("#")))throw new Error("Error: Found # in a class name. Did you mean to do elt#id.classes instead of elt.classes#id?");e||(e="div");let s=ne(e);return n&&(s.id=n),r?.length&&r.forEach(o=>s.classList.add(o)),s},ie=t=>{let e=t?t.match(/([0-9a-zA-Z\-]*)?(#[0-9a-zA-Z\-]*)?((.[0-9a-zA-Z\-]+)*)/):void 0,n=e?e.slice(1,4)?.map(r=>r?r.trim():void 0):Array(3).fill(void 0);return n&&n[1]&&(n[1]=n[1].replace(/#*/g,"")),e?{tag:n[0]||void 0,id:n[1]||void 0,classes:n[2]?n[2].split(".").filter(r=>r.trim()):void 0}:{}},b=class{constructor(e,n){this.props={};this.elem=typeof e=="string"?se(e):e,this.props=n||{}}cls(e,n=!0){var r;return(r=this.props).classes??(r.classes={}),this.props.classes[e]=!!n,this}done(){return A(this.elem,this.props)}ref(){return this.done()[0]}content(e){return this.props.contents=e,this}render(e){return this.props.render=e,this}attr(e,n){var r;return(r=this.props).attrs||(r.attrs={}),this.props.attrs[e]=n.toString(),this}attrs(e){return this.props.attrs=e,this}raw(e){return this.props.raw=e,this}misc(e,n){var r;return(r=this.props).misc||(r.misc={}),typeof e=="object"?this.props.misc=e:this.props.misc[e]=n,this}style(e,n){var r;return(r=this.props).style||(r.style={}),this.props.style[e]=n,this}styles(e){return this.props.style=e??{},this}on(e,n){var r;return(r=this.props).on||(r.on={}),this.props.on[e]=n,this}gimme(...e){var n;return(n=this.props).gimme||(n.gimme=[]),this.props.gimme=e,this}deps(e){return this.props.deps={...this.props.deps,...e},this}html(e,...n){return this.props.raw=!0,typeof e=="string"?this.props.contents=e:Array.isArray(e)&&(this.props.contents=H(e,...n)),this}children(e){return this.props.children=e,this}};l.isBrowser()&&("MutationObserver"in globalThis?q():console.warn("MutationObserver was not found in your browser. Campfire will","not be able to warn you of destructive mutations!"));var _=t=>{let e={};for(let n in t){let r=t[n].value;r instanceof Map?e[n]=Object.fromEntries(r.entries()):e[n]=r.valueOf()}return e},oe=t=>!(!t||typeof t!="function"),W=(t,e)=>Object.keys(e).forEach(n=>{e[n]?t.classList.add(n):t.classList.remove(n)}),$=(t,e)=>{let{style:n={},attrs:r={},misc:s={},classes:o={}}=e.props;return W(t,o),Object.assign(t.style,n),r&&Object.entries(r||{}).forEach(([u,d])=>{typeof d=="string"&&d.length===0?t.removeAttribute(u):t.getAttribute(u)!==String(d)&&t.setAttribute(u,String(d))}),s&&Object.assign(t,s),t},A=(t,e={})=>{let{contents:n,render:r,misc:s,style:o,on:u={},attrs:d={},raw:x,classes:D={},gimme:y=[],deps:M={},children:I={}}=e,C=!!x;W(t,D);let E="";if(oe(r)){Object.entries(M).forEach(([c,f])=>{f.any(h=>{let ee=new b(t),T=r(_(M),{event:{...h,triggeredBy:c},elt:t,b:ee});if(T!==void 0){let te=L({s:"[data-cf-slot]",all:!0,from:t}).map(g=>[g.getAttribute("data-cf-slot"),g]);if(typeof T=="string")t.innerHTML=T;else{let g=T.props.contents||"";t.innerHTML=T.props.raw?g:p(g),$(t,T)}te.forEach(([g,re])=>{t.querySelector(`cf-slot[name='${g}']`)?.replaceWith(re)})}})});let a=r(_(M),{elt:t,b:new b(t)});typeof a>"u"?t.setAttribute("data-cf-fg-updates","true"):(t.removeAttribute("data-cf-fg-updates"),typeof a=="string"&&(E=a),a instanceof b&&(C=!!a.props.raw,E=a.props.contents||"",$(t,a)))}else typeof n=="string"&&(E=n);E?.trim()&&(t.innerHTML=C?E:p(E),t.querySelectorAll("cf-slot[name]").forEach(a=>{let c=a.getAttribute("name");if(c&&c in I){let f=I[c],[h]=Array.isArray(f)?f:[f];if(!h)return;a.replaceWith(h),h.setAttribute("data-cf-slot",c)}})),Object.values(M).map(a=>a.id).length?t.setAttribute("data-cf-reactive","true"):t.removeAttribute("data-cf-reactive"),s&&Object.assign(t,s),o&&Object.assign(t.style,o),Object.entries(u).forEach(([a,c])=>l.addElEventListener(t,a,c)),Object.entries(d).forEach(([a,c])=>{let f=t.getAttribute(a),h=String(c);f!==h&&(typeof c=="string"&&c.length===0?t.removeAttribute(a):t.setAttribute(a,String(c)))});let R=[];for(let a of y){let c=t.querySelector(a);R.push(c)}return[t,...R]},V=(t="div",e={})=>new b(t,e);var Z=new Set,G=()=>"cf-"+Math.random().toString(36).slice(2,8),ae=()=>{let t=G();for(;Z.has(t);)t=G();return Z.add(t),t},m=class{constructor(e){this.id=ae();this._subscribers={};this._subscriberCounts={};this._dead=!1;this.value=e}on(e,n){var s,o;(s=this._subscriberCounts)[e]??(s[e]=0),(o=this._subscribers)[e]??(o[e]={});let r=this._subscriberCounts[e]++;return this._subscribers[e][r]=n,this._subscriberCounts[e]++}any(e){this.on("append",e),this.on("change",e),this.on("clear",e),this.on("deletion",e),this.on("update",e)}unsubscribe(e,n){delete this._subscribers[e]?.[n]}update(e){this._dead||(this.value=e,this._sendEvent({type:"update",value:e}))}_sendEvent(e){if(this._dead)return;let n=this._subscribers[e.type];if(n)for(let r in n)n[r](e)}dispose(){this._dead=!0,this._subscribers={},this._subscriberCounts={}}valueOf(){return structuredClone(this.value)}};var v=class extends m{constructor(e){super(e||[])}clear(){this.value=[],this._sendEvent({type:"clear"})}push(e){return this.value.push(e),this._sendEvent({type:"append",value:e,idx:this.value.length-1}),this.value.length}remove(e){if(e<0||e>=this.value.length)throw new RangeError("Invalid index.");this._sendEvent({type:"deletion",idx:e,value:this.value.splice(e,1)[0]})}get(e){if(e<0||e>=this.value.length)throw new RangeError("Invalid index.");return this.value[e]}set(e,n){if(e<0||e>=this.value.length)throw new RangeError("Invalid index.");this.value[e]=n,this._sendEvent({type:"change",value:n,idx:e})}get length(){return this.value.length}};var w=class extends m{constructor(e){super(new Map);for(let[n,r]of Object.entries(e||{}))this.value.set(n,r)}set(e,n){this.value.set(e,n),this._sendEvent({key:e,value:n,type:"change"})}remove(e){let n=this.value.get(e);n&&(this.value.delete(e),this._sendEvent({key:e,value:n,type:"deletion"}))}clear(){this.value=new Map,this._sendEvent({type:"clear"})}transform(e,n){let r=this.value.get(e);if(!r)throw new Error(`ERROR: key ${e} does not exist in store!`);let s=n(r);this.set(e,s),this._sendEvent({type:"change",value:s,key:e})}get(e){return this.value.get(e)}has(e){return this.value.has(e)}entries(){return this.value.entries()}};function J(t){if("type"in t){if(t.type==="list")return new v(t.value);if(t.type==="map")return new w(t.value)}return new m(t.value)}var le=t=>{let e=/\\?({{{\s*([^}]+)\s*}}}|{{[#^/]?\s*([^}]+)\s*}})/g,n=0,r=[],s=e.exec(t);for(;s!==null;){let[o,u,d,x]=s,D=o.startsWith("\\"),y=o.length>2?o[2]:null;n<s.index&&r.push({type:"text",value:t.slice(n,s.index)}),D?r.push({type:"text",value:u}):y==="/"?r.push({type:"section-close",key:x}):y==="#"||y==="^"?r.push({type:"section-open",key:x?.trim(),inverted:y==="^"}):r.push({type:"var",key:(d||x)?.trim(),unescaped:!!d}),n=e.lastIndex,s=e.exec(t)}return n<t.length&&r.push({type:"text",value:t.slice(n)}),r};function ce(t){let e=[],n=[e];for(let r of t)if(r.type==="section-open"){let s={type:"section",key:r.key,inverted:r.inverted,children:[]};n.at(-1)?.push(s),n.push(s.children)}else if(r.type==="section-close"){if(n.length===1)throw new Error(`Unexpected closing tag ${r.key}`);n.pop()}else n.at(-1)?.push(r);if(n.length>1)throw new Error("Unclosed section(s) found");return e}var Q=t=>ce(le(t)),S=(t,e,n)=>t.map(r=>{switch(r.type){case"text":return r.value;case"var":{if(r.key==="."&&"."in e)return r.unescaped?String(e["."]):p(String(e["."]));if(!(r.key in e))return r.unescaped?`{{{ ${r.key} }}}`:`{{ ${r.key} }}`;let s=String(e[r.key]);return r.unescaped?s:p(s)}case"section":{let s=e[r.key],o=!!s;return r.inverted&&(o=s===null||s===!1||typeof s>"u"||Array.isArray(s)&&s.length===0),o?r.inverted?S(r.children,e,n):Array.isArray(s)?s.map(u=>S(r.children,typeof u=="object"?u:{".":u},e)).join(""):typeof s=="object"&&s!==null?S(r.children,s,e):S(r.children,e,n):""}}}).join(""),X=(t,e)=>S(Q(t),e),Y=t=>{let e=Q(t);return n=>S(e,n)};var $e={ListStore:v,MapStore:w,Store:m,store:J,nu:V,mustache:X,template:Y,escape:p,unescape:z,extend:A,insert:N,empty:k,rm:O,select:L,onload:P,html:H,r:K,seq:B,CfDom:l,callbackify:F,poll:U};export{l as CfDom,v as ListStore,w as MapStore,m as Store,F as callbackify,$e as default,k as empty,p as escape,A as extend,H as html,N as insert,X as mustache,V as nu,P as onload,U as poll,K as r,O as rm,L as select,B as seq,J as store,Y as template,z as unescape};
//# sourceMappingURL=campfire.esm.min.js.map
